<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="indi.xezzon.school.jwc.repository.CourseMapper">
    <resultMap id="course" type="indi.xezzon.school.common.model.Course">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="credit" column="credit"/>
        <result property="containment" column="containment"/>
        <result property="type" column="type"/>
        <association property="teacher" javaType="indi.xezzon.school.common.model.Teacher">
            <id property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="phone" column="phone"/>
            <result property="email" column="email"/>
            <result property="readme" column="readme"/>
        </association>
        <collection property="schedules" ofType="indi.xezzon.school.common.model.CourseSchedule" select="indi.xezzon.school.jwc.repository.CourseScheduleMapper.queryByCourseId" column="id" foreignColumn="course_id">
            <result property="startWeek" column="start_week"/>
            <result property="endWeek" column="end_week"/>
            <result property="abWeek" column="ab_week"/>
            <result property="wk" column="wk"/>
            <result property="tempo" column="tempo"/>
            <result property="classhour" column="classhour"/>
            <result property="building" column="building"/>
            <result property="doorplate" column="doorplate"/>
        </collection>
    </resultMap>

    <select id="query" resultMap="course">
        SELECT *
        FROM course c
        INNER JOIN teacher t
        ON c.teacher_id =t.id
        <where>
            <if test="t.name!=null">AND name = #{t.name}</if>
            <if test="t.type!=null">AND type = #{t.type}</if>
            <if test="t.credit!=null">AND credit = #{t.credit}</if>
            <if test="t.containment!=null">AND containment = #{t.containment}</if>
            <if test="t.teacher!=null and t.teacher.id!=null">AND teacher_id = #{t.teacher.id}</if>
        </where>
        <if test="orderBy!=null">ORDER BY #{orderBy}</if>
        <if test="orderBy!=null and desc">DESC</if>
        <if test="pageSize!=null">LIMIT #{pageSize}</if>
        <if test="pageSize!=null and pageNum != null">OFFSET #{pageNum}</if>
    </select>
    <select id="count" resultType="int">
        SELECT COUNT(1)
        FROM course
        <where>
            <if test="id!=null">AND id = #{id}</if>
            <if test="name!=null">AND name = #{name}</if>
            <if test="type!=null">AND type = #{type}</if>
            <if test="credit!=null">AND credit = #{credit}</if>
            <if test="containment!=null">AND containment = #{containment}</if>
            <if test="teacher!=null and teacher.id!=null">AND teacher_id = #{teacher.id}</if>
        </where>
    </select>
</mapper>